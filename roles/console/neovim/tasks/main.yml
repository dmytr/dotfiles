---
- name: Install packages
  include_role:
    name: system/package
  vars:
    package_names:
      - neovim
      - python3-neovim

- name: Create configuration folders
  file:
    path: "{{ item }}"
    owner: "{{ user_name }}"
    group: "{{ user_group }}"
    state: directory
  with_items:
    - "{{ home_dir }}/.config"
    - "{{ home_dir }}/.cache/vimfiles/repos/github.com/Shougo"
    - "{{ home_dir }}/.local/share/fonts"

- name: Link configuration files
  file:
    src: "{{ playbook_dir }}/vendor/SpaceVim"
    dest: "{{ home_dir }}/.config/nvim"
    owner: "{{ user_name }}"
    group: "{{ user_group }}"
    state: link

- name: Link spacevim configuration files
  file:
    src: "{{ role_path }}/files/spacevim.d"
    dest: "{{ home_dir }}/.SpaceVim.d"
    owner: "{{ user_name }}"
    group: "{{ user_group }}"
    state: link

- name: Install plugin manager
  file:
    src: "{{ playbook_dir }}/vendor/dein.vim"
    dest: "{{ home_dir }}/.cache/vimfiles/repos/github.com/Shougo/dein.vim"
    owner: "{{ user_name }}"
    group: "{{ user_group }}"
    state: link

- name: Find fonts
  find:
    paths: "{{ role_path }}/files/fonts"
    patterns: "*.ttf"
    recurse: no
  register: fonts

- name: Install fonts
  file:
    src: "{{ role_path }}/files/fonts/{{ item.path | basename }}"
    dest: "{{ home_dir }}/.local/share/fonts/{{ item.path | basename }}"
    owner: "{{ user_name }}"
    group: "{{ user_group }}"
    state: link
  with_items: "{{ fonts.files }}"
  notify: "rebuild fonts cache"

- name: Rebuild fonts cache
  shell: "{{ item }}"
  with_items:
    - "fc-cache -vf"
    - "mkfontdir {{ home_dir }}/.local/share/fonts"
    - "mkfontscale {{ home_dir }}/.local/share/fonts"
  become: no
